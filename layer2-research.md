# 1 以太坊Layer2

## 1.1 为什么要有构建Layer2

Layer2 是以太坊扩容方案的总称

以太坊作为比较成功的去中心化区块链网络之一，每天处理交易的上限是100多万笔，但这个数字远远跟不上实际需求，举个例子，支付宝每天的交易量在2500万笔以上。所以Layer2主要是为了解决这个痛点而提出的，即提升交易速度和交易吞吐量但依然具有足够的安全性

目前以太坊的交易费以及Layer2平均交易费用

**Layer2 平均交易费用**

![image-20221031113817425](/Users/qinjianquan/Career/ethereum/static/layer2-tx-fee.png)

**以太坊交易费用**

![image-20221031113858355](/Users/qinjianquan/Career/ethereum/static/eth-tx-fee.png)

## 1.2 Layer2 技术方案：Rollup

不管是任何二层扩容方案，在技术上都使用的是Rollup方案，简单理解就是先在二层网络上将多笔交易打包成一笔，然后定期同以太坊网络通信以提交捆绑的交易。这样对每一个用户来说，交易费用都会更便宜，确认速度也会更快

### 1.2.1 Optimistic Rollup

一般认为所有的交易都是合法的，但是仍然需要识别无效/恶意交易。因此Optimistic Rollup设计了一个争议解决系统，具体是向第一层提交交易的一方必须提供保证金，通常是ETH，而网络的其他参与者都可以提交欺诈证明，此时系统会进入争议解决模式，将该笔交易在以太坊上重新执行，如果交易欺诈，提交者的保证金将被削减。这种机制会促使批量交易的提交者不会冒着较大的资产损失风险去欺诈，因而最终能实现诚实交易

缺点是必须为网络参与者提供足够多的时间提交欺诈性证明，而这个时间可能会相当长，当然有些针对这个问题的解决方案，比如提供快速的”流动性存在“解决这种情况，能够实现几乎实时到第一层

### 1.2.2 ZK Rollup

另外一种对交易的验证方案是零知识证明。该方案中，发不到layer1的每笔交易都包含一个称为ZK-SNARK的加密证明，第一层的合约能够快速验证

但是该方案使得创建与EVM兼容的ZK难度较大，也使得在无需重写应用程序逻辑的情况下扩展通用应用程序变得更加困难

另外，需要注意的是二者都需要运行自己的EVM版本，Optimistic Rollup在与以太坊EVM兼容性上相比，更加容易，只需修改少量代码，99%的合约都可以无缝移植。但它们都可以将以太坊的TPS（15-45）扩展到1000-4000TPS，本质上是通过创建多个分片来增加可能的数据可用性空间，这使得可以存储大量数据，以太坊和Rollup结合可以将以太坊的交易速度提高到100k每秒

### 1.2.3 代表项目

**Optimistic Rollup**

ARBITRUM

**ZK Rollup**

zkSync

## 1.3 Layer2 技术方案：侧链

侧链是一个独立的区块链网络与以太坊主链并行运行。侧链通过双向挂钩系统与主链连接，允许资产在侧链之间进行交换

侧链有两种类型：一种相互依赖，一种相互独立

当一条链依赖于另一条链（像以太坊）时，它被认为是子链，不会创建自己的资产，而是从父链的转移中获取资产

但是坦率而言，以太坊虽然成功，但是在技术上也非常的“古老”，本身设计的局限性让很多项目方觉得与其在其之上缝缝补补倒不如构建新的链，这也就有了后来专注于速度的Solana和专注于更底层可扩展性的的Polkadot以及Cosmos等等

